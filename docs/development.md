# Журнал разработки

## 2025-10-19 — Этап 1 (старт)

- Инициализирован репозиторий `bedolaga-admin`.
- Сформирована базовая структура каталога: `app/` с пакетами `core`, `db`, `models`, `admin`.
- Добавлены `.env.example`, дорожная карта и первичный README.
- Реализованы настройки `Settings`, подключение к БД и фабрика асинхронных сессий.
- Создана модель `AdminUser`, авторизационный backend `BedolagaAuthenticationBackend`, базовый `AdminUserAdmin`.
- Настроено FastAPI-приложение с SQLAdmin и `/health`.
- Добавлен CLI `scripts/create_admin.py` для ручного создания суперпользователя.
- Настроена веб-форма `/admin/setup`, доступная до появления первого администратора, и middleware для редиректа.
- Собран план этапа 2 и зафиксированы сущности для отображения (пользователи, подписки, транзакции).
- Добавлены асинхронные модели `User`, `Subscription`, `Transaction`, `PromoGroup` и представления SQLAdmin для просмотра данных без прав на изменение.
- Подготовлена заглушка для действий web API: страница `/admin/actions` с описанием и кнопками без фактической интеграции.
- Реализован клиент `WebAPIClient`, добавлены реальные вызовы web API (продление подписки, баланс, блокировка, синхронизация), обновлена страница действий и документация.
- Запланирован этап 3 (безопасность, роли, аудит): подготовлен документ `docs/stage3-plan.md` и обновлена дорожная карта.
- Реализована ролевая модель, проверки разрешений в SQLAdmin и на `/admin/actions`, добавлен журнал `AdminActivityLog`, сервис логирования и скрипт `scripts/init_roles.py`.
- Добавлены настройки безопасности: лимиты на сумму операций, подтверждения блокировок/баланса и защита форм CSRF.

## 2025-10-20 — Этап 3 → Этап 4

- Включена автоматическая синхронизация базовых ролей: `ensure_default_roles()` вызывается на старте, `scripts/init_roles.py` переиспользует новый сервис.
- Страница `/admin/actions` получила фирменный дизайн: новые стили `app/static/admin.css`, фон с логотипом, подсказки и статусные бейджи.
- Подключена раздача статических файлов и добавлен логотип Bedolaga в `app/static/bedolaga-logo.svg`.
- Создан план этапа 4 (`docs/stage4-plan.md`), обновлена дорожная карта.
- Переопределён шаблон SQLAdmin: новый layout (`app/templates/sqladmin/layout.html`), собственный css (`app/static/sqladmin.css`), кастомный сайдбар и шапка.
- Добавлены макросы переводов (`app/i18n`), middleware определения языка и интеграция в шаблоны SQLAdmin.
- Локализованы основной список, формы создания/редактирования, страница деталей, логин и модальные окна SQLAdmin; подготовлены собственные версии шаблонов в `app/templates/sqladmin/`.

> Дальше — перевести оставшиеся сообщения (flash, валидация), собрать дашборд и добавить подсказки для форм.
